# Список изменений {{ ydb-short-name }} Server

## Версия 23.2 {#23-2}

Дата выхода: 14 августа 2023.

**Функциональность:**

* **_(Экспериментально)_** Реализована видимость собственных изменений. При включении этой функции вы можете читать измененные значения из текущей транзакции, которая еще не была закоммичена. Также эта функциональность позволяет выполнять несколько модифицирующих операций в одной транзакции над таблицей с вторичными индексами. Для включения этой функциональности добавьте `enable_kqp_immediate_effects: true` в секцию `table_service_config` в [конфигурационный файл](deploy/configuration/config.md).
* **_(Экспериментально)_** Реализованы итераторные чтения. Эта функциональность позволяет разделить чтения и вычисления между собой. Итераторные чтения позволяют даташардам увеличить пропускную способность читающих запросов. Для включения этой функциональности добавьте `enable_kqp_data_query_source_read: true` в секцию `table_service_config` в [конфигурационный файл](deploy/configuration/config.md).

**Встроенный UI:**

* Улучшена навигация:
  * Кнопки переключения между режимами диагностики и разработки вынесены на левую панель.
  * На всех страницах добавлены хлебные крошки.
  * На странице базы данных информация о группах хранения и узлах базы перенесена во вкладки.
* История и сохраненные запросы перенесены во вкладки над редактором запросов.
* На вкладках Info для объектов схемы настройки выведены в терминах конструкции `CREATE` или `ALTER`.
* Поддержано отображение [колоночных таблиц](concepts/datamodel/table.md#column-table) в дереве схемы.

**Производительность:**

* Для сканирующих запросов реализована возможность эффективного поиска отдельных строк с использованием первичного ключа или вторичных индексов, что позволяет во многих случаях значительно улучшить производительность. Как и в обычных запросах, для использования вторичного индекса необходимо явно указать его имя в тексте запроса с использованием ключевого слова `VIEW`.

* **_(Экспериментально)_** Добавлена возможность управлять системными таблетками базы (SchemeShard, Coordinators, Mediators, SysViewProcessor) её собственному Hive'у, вместо корневого Hive'а, и делать это сразу в момент создания новой базы. Без этого флага системные таблетки новой базы создаются в корневом Hive'е, что может негативно сказаться на его загруженности. Включение этого флага делает базы полностью изолированными по нагрузке, что может быть особенно актуально для инсталляций, состоящих из ста и более узлов. Для включения этой функциональности добавьте `alter_database_create_hive_first: true` в секцию `feature_flags` в [конфигурационный файл](deploy/configuration/config.md).

**Исправления ошибок:**

* Исправлена ошибка в автоконфигурации акторной системы, в результате чего вся нагрузка ложится на системный пул.
* Исправлена ошибка, приводящая к полному сканированию при поиске по префиксу первичного ключа через `LIKE`.
* Исправлены ошибки при взаимодействии с фолловерами даташардов.
* Исправлены ошибки при работе с памятью в колоночных таблицах.
* Исправлена ошибки при обработке условий для immediate-транзакций.
* Исправлена ошибка в работе итераторных чтений на фолловерах даташардов.
* Исправлена ошибка, приводящая к лавинообразной переустановке сессий доставки данных до асинхронных индексов
* Исправлены ошибки в оптимизаторе в сканирующих запросах
* Исправлена ошибка некорректного расчёта потребления хранилища hive'ом после расширения базы
* Исправлена ошибка зависания операций от несуществующих итераторов
* Исправлены ошибки при чтении диапазона на `NOT NULL` колонке
* Исправлена ошибка зависания репликации VDisk'ов
* Исправлена ошибка в работе опции `run_interval` в TTL

## Версия 23.1 {#23-1}

Дата выхода 5 мая 2023. Для обновления до версии 23.1 перейдите в раздел [Загрузки](downloads/index.md#ydb-server).

**Функциональность:**

* Добавлено [первоначальное сканирование таблицы](concepts/cdc.md#initial-scan) при создании потока изменений CDC. Теперь можно выгрузить все данные, которые существуют на момент создания потока.
* Добавлена возможность [атомарной замены индекса](best_practices/secondary_indexes.md#atomic-index-replacement). Теперь можно атомарно и прозрачно для приложения подменить один индекс другим заранее созданным индексом. Замена выполняется без простоя.
* Добавлен [аудитный лог](cluster/audit-log.md) — поток событий, который содержит информацию обо всех операциях над объектами {{ ydb-short-name }}.

**Производительность:**

* Улучшены форматы передачи данных между стадиями исполнения запроса, что ускорило SELECT на запросах с параметрами на 10%, на операциях записи — до 30%.
* Добавлено [автоматическое конфигурирование](deploy/configuration/config.md#autoconfig) пулов акторной системы в зависимости от их нагруженности. Это повышает производительность за счет более эффективного совместного использования ресурсов ЦПУ.
* Оптимизирована логика применения предикатов — выполнение ограничений с использованием OR и IN с параметрами автоматически переносится на сторону DataShard.
* (Экспериментально) Для сканирующих запросов реализована возможность эффективного поиска отдельных строк с использованием первичного ключа или вторичных индексов, что позволяет во многих случаях значительно улучшить производительность. Как и в обычных запросах, для использования вторичного индекса необходимо явно указать его имя в тексте запроса с использованием ключевого слова `VIEW`.
* Реализовано кеширование графа вычисления при выполнении запросов, что уменьшает потребление ЦПУ при его построении.

**Исправления ошибок:**

* Исправлен ряд ошибок в реализации распределенного хранилища данных. Мы настоятельно рекомендуем всем пользователям обновиться на актуальную версию.
* Исправлена ошибка построения индекса на not null колонках.
* Исправлен подсчет статистики при включенном MVCC.
* Исправлены ошибки с бэкапами.
* Исправлена гонка во время сплита и удаления таблицы с CDC.

## Версия 22.5 {#22-5}

Дата выхода 7 марта 2023. Для обновления до версии **22.5** перейдите в раздел [Загрузки](downloads/index.md#ydb-server).

**Что нового:**

* Добавлены [параметры конфигурации потока изменения](yql/reference/syntax/alter_table.md#changefeed-options) для передачи дополнительной информации об изменениях в топик.
* Добавлена поддержка [переименования для таблиц](concepts/datamodel/table.md#rename) с включенным TTL.
* Добавлено [управление временем хранения записей](concepts/cdc.md#retention-period) для потока изменений.

**Исправления ошибок и улучшения:**

* Исправлена ошибка при вставке 0 строк операцией BulkUpsert.
* Исправлена ошибка при импорте колонок типа Date/DateTime из CSV.
* Исправлена ошибка импорта данных из CSV с разрывом строки.
* Исправлена ошибка импорта данных из CSV с пустыми значениями.
* Улучшена производительность Query Processing (WorkerActor заменен на SessionActor).
* Компактификация DataShard теперь запускается сразу после операций split или merge.

## Версия 22.4 {#22-4}

Дата выхода 12 октября 2022. Для обновления до версии **22.4** перейдите в раздел [Загрузки](downloads/index.md#ydb-server).

**Что нового:**

* {{ ydb-short-name }} Topics и Change Data Capture (CDC):
  * Представлен новый Topic API. [Топик](concepts/topic.md) {{ ydb-short-name }} — это сущность для хранения неструктурированных сообщений и доставки их различным подписчикам.
  * Поддержка нового Topic API добавлена в [{{ ydb-short-name }} CLI](reference/ydb-cli/topic-overview.md) и [SDK](reference/ydb-sdk/topic.md). Topic API предоставляет методы потоковой записи и чтения сообщений, а также управления топиками.
  * Добавлена возможность [захвата изменений данных таблицы](concepts/cdc.md) с отправкой сообщений об изменениях в топик.

* SDK:
  * Добавлена возможность взаимодействовать с топиками в {{ ydb-short-name }} SDK.
  * Добавлена официальная поддержка драйвера database/sql для работы с {{ ydb-short-name }} в Golang.

* Embedded UI:
  * Поток изменений CDC и вторичные индексы теперь отображаются в иерархии схемы базы данных как отдельные объекты.
  * Улучшена визуализация графического представления query explain планов.
  * Проблемные группы хранения теперь более заметны.
  * Различные улучшения на основе UX-исследований.

* Query Processing:
  * Добавлен Query Processor 2.0 — новая подсистема выполнения OLTP-запросов со значительными улучшениями относительно предыдущей версии.
  * Улучшение производительности записи составило до 60%, чтения до 10%.
  * Добавлена возможность включения ограничения NOT NULL для первичных ключей в YDB во время создания таблиц.
  * Включена поддержка переименования вторичного индекса в режиме онлайн без остановки сервиса.
  * Улучшено представление query explain, которое теперь включает графы для физических операторов.

* Core:
  * Для read-only транзакций добавлена поддержка консистентного снапшота, который не конфликтует с пишущими транзакциями.
  * Добавлена поддержка BulkUpsert для таблиц с асинхронными вторичными индексами.
  * Добавлена поддержка TTL для таблиц с асинхронными вторичными индексами.
  * Добавлена поддержка сжатия при экспорте данных в S3.
  * Добавлен audit log для DDL statements.
  * Поддержана аутентификация со статическими учетными данными.
  * Добавлены системные таблицы для диагностики производительности запросов.
